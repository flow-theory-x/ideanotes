# 音声操作の安全ルール「破壊的行動は通常接続で」

*2025-07-23*

## 📝 必要な制限

「破壊的行動は許可されません。通常接続をしてください」- これは音声インターフェースに必須の安全設計。

## 🎯 音声操作の権限レベル

### レベル1：読み取り専用（音声OK）
```
✅ 「ログを確認して」
✅ 「エラーの原因を調べて」  
✅ 「現在の状態を教えて」
✅ 「テストの結果は？」
```

### レベル2：非破壊的変更（条件付きOK）
```
⚠️ 「キャッシュをクリア」→ 確認後OK
⚠️ 「設定を変更」→ ドライラン後OK
⚠️ 「新規ファイル作成」→ 確認後OK
```

### レベル3：破壊的操作（音声NG）
```
❌ 「本番データベースを削除」
❌ 「全ファイルを削除」
❌ 「ユーザーデータをリセット」
→ 「この操作は音声では実行できません。通常接続してください」
```

## 💡 実装パターン

### コマンド分類システム
```python
DESTRUCTIVE_PATTERNS = [
    r"削除|delete|remove|rm",
    r"リセット|reset|clear.*data",
    r"本番|production|prod",
    r"データベース.*削除|drop.*database",
]

def check_command_safety(command):
    for pattern in DESTRUCTIVE_PATTERNS:
        if re.search(pattern, command, re.I):
            return "DESTRUCTIVE"
    return "SAFE"
```

### 音声応答の設計
```
破壊的操作を検知した場合：
Claude：「この操作は重要な変更を含みます。
        安全のため、PCから直接実行してください。
        コマンドをSlackに送信しますか？」
```

### 代替案の提示
```
ユーザー：「全部削除して」
Claude：「音声では実行できません。代わりに：
        1. 削除対象のリストを確認
        2. バックアップを作成
        3. 削除コマンドをメモ送信
        どれを実行しますか？」
```

## 🚀 段階的な安全対策

### 環境別の制限
```
開発環境：比較的自由
ステージング：一部制限
本番環境：厳格な制限
```

### 時間帯制限
```
営業時間内：通常権限
深夜・休日：読み取りのみ
緊急時：特殊コード入力で解除
```

### 操作履歴による学習
```
# 過去に問題を起こしたコマンドを記録
BLOCKED_HISTORY = [
    "rm -rf /var/www/*",  # 2024-01-15 incident
    "UPDATE users SET ...", # 2024-02-20 incident
]
```

## 🤔 ユーザビリティとの両立

### スマートな判定
```
「ログファイルを削除」
→ 古いログのみOK、最新ログはNG

「テストデータをリセット」
→ テスト環境ならOK、本番はNG
```

### 教育的なフィードバック
```
Claude：「その操作は影響が大きいため、
        音声では実行できません。
        理由：10万件のデータが失われる可能性
        推奨：まずバックアップを作成」
```

### エスカレーションパス
```
1. 音声で意図を確認
2. 実行計画を作成
3. PCに通知を送信
4. PCで最終確認して実行
```

## 🎯 期待される効果

### 事故防止
- 誤った音声認識による事故を防止
- 「つい口走った」による被害を防止
- 酔っ払いデプロイの防止（？）

### 意識向上
- 破壊的操作への意識が高まる
- より慎重な運用文化の醸成
- インシデントの大幅削減

「便利だけど危険」から「便利で安全」へ。これが音声操作の正しい進化。